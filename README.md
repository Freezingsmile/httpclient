
# HttpClient异步原理性实验

httpclient模拟系统之间的交互程度不高，不过httpclient是作为WEB容器的web请求存在，在http协议下，都是无状态的协议，也就是连接-请求-反馈-断开几个基本动作，好在现在WEB容器有了keep-alive的功能，包括很多负载均衡设备：如：LB、LVS、nginx、apache、jboss、tomcat等等都是支持的，虽然支持，但是看看上面的代码，就发现，每次请求都会重新建立连接，如何让他们不要重复创建连接呢？或者说在服务器端没有断开前不要重复创建连接，一个连接可以被使用多次请求，不至于一次请求就被断开一次；建立一次连接需要三次握手过程，以及更多的网络开销。
 这和链接数据库差不多，将上面的请求的client对象以及method对象作为共享变量时，发起多次请求，平均效率会提升2倍左右。

但是对于并发较高的，我们不可能将method只用一个，因为它本身不能并发，于是我们就要用多个，在多个共享的对象中，如果控制好征用，有涉及到连接池的问题，不过这个连接池相对数据库的连接池要简单很多，因为重试等动作，apache已经包装好了，只需要顺序找和分配就可以了，如何降低竞争就是算法和策略的问题了。
 
然后，apache又为我们提供了一个端口，就是异步httpclient（其实这里所知的异步并非真正的异步IO模式），也就是将这部分包装了，对于访问者来说还是同步的，只是在IO层面是非阻塞的了。
 
![image](https://github.com/Freezingsmile/httpclient/blob/master/QQ%E5%9B%BE%E7%89%8720180107185157.png)
![image](https://github.com/Freezingsmile/httpclient/blob/master/QQ%E5%9B%BE%E7%89%8720180107185258.png)
